version: "3.9"

volumes:
  shared-mointor:

services:
  ocserv_and_backend:
    restart: always
    image: ocserv_and_backend:ocserv_dev
    container_name: ocserv_and_backend_for_frontend
    privileged: true
    build:
      context: .
      dockerfile: Dockerfile.Dev
    ports:
      - 20443:443/tcp
      - 20443:443/udp
      - 127.0.0.1:8000:8000
    env_file:
      - dev.env
    volumes:
      - ./back-end:/app
      - ./volumes/ocserv:/etc/ocserv
      - shared-mointor:/var/log

  monitor:
    image: monitor:ocserv_dev
    container_name: monitor_dev
    build:
      context: .
      dockerfile: Dockerfile.Monitor
    ports:
      - 127.0.0.1:8080:8080
    environment:
      - SOCKET_PASSWD_FILE=/tmp/socket_passwd
      - LOG_FILE=/var/log/ocserv.log
    volumes:
      - shared-mointor:/shared_mointor
    depends_on:
      - ocserv_and_backend
#
#
#
# DOCKER_SCAN_SUGGEST=false docker compose -f docker-compose.dev.yml up -d --build
