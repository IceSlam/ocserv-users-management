{% extends 'base.html' %}

{% block body %}
<h2 class="mb-4 mt-4">User Management Page</h2>
    
            <table class="table table-striped table-dark">
                <thead>
                    <tr class="text-center">
                        <th scope="col">Row</th>
                        <th scope="col">Ocserv Username</th>
                        <th scope="col">Ocserv Password</th>
                        <th scope="col">Active</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in object_list %}
                    <tr class="text-center">
                        <th scope="row">{{ forloop.counter }}</th>
                        <td>{{ user.oc_username }}</td>
                        <td>{{ user.oc_password }}</td>
                        <td>{{ user.oc_active }}</td>
                        <td>
                            {% if user.oc_active %}
                            <button class="btn btn-outline-warning btn-sm mx-1" onclick="userHandler('{{ user.id }}', 'deactive')"
                                id="deactive-{{ user.id }}">
                                Deactive
                            </button>
                            {% else %}
                            <button class="btn btn-outline-info btn-sm  mx-1" onclick="userHandler('{{ user.id }}', 'active')"
                                id="active-{{ user.id }}">
                                Active
                            </button>
                            {% endif %}

                            <button class="btn btn-outline-danger btn-sm" onclick="deleteUser('{{ user.id }}')"
                                id="del-{{ user.id }}">Delete</button>
                            <button class="btn btn-outline-danger btn-sm" style="display: none;"
                                onclick="confirmDelete('{{ user.id }}')" id="confirm-{{ user.id }}">Delete</button>
                            <button class="btn btn-outline-light btn-sm mx-1" style="display: none;"
                                onclick="cancelDelete('{{ user.id }}')" id="cancel-{{ user.id }}">Cancel</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

<script>
    function deleteUser(userId) {
        $('#del-' + userId).css('display', 'none');
        $('#confirm-' + userId).css('display', 'inline');
        $('#cancel-' + userId).css('display', 'inline');
        $('#deactive-' + userId).css('display', 'none');
        $('#active-' + userId).css('display', 'none');
    }

    function cancelDelete(userId) {
        $('#del-' + userId).css('display', 'inline');
        $('#confirm-' + userId).css('display', 'none');
        $('#cancel-' + userId).css('display', 'none');
        $('#deactive-' + userId).css('display', 'inline');
        $('#active-' + userId).css('display', 'inline');
    }

    function confirmDelete(userId) {
        $.ajax({
            url: "del_user/",
            data: {
                'user_id': userId,
            },
            success: function (response) {
                location.reload(true);
            },
            error: function (response) {
                alert(response["responseJSON"]["error"]);
            }
        });
    }

    function userHandler(userId, action) {
        $.ajax({
            url: "handler_user/",
            data: {
                'user_id': userId,
                'action' : action,
            },
            success: function (response) {
                location.reload(true);
            },
            error: function (response) {
                alert(response["responseJSON"]["error"]);
            }
        });
    }

</script>


{% endblock %}